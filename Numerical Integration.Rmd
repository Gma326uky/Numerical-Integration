---
title: 'Numerical Inegration of exp(x) function'
output:
  html_document:
    df_print: paged
---

For this assignment, I will need to load the tidyverse package.


```{r}

# Install Tidyverse
options(repos = c(CRAN = "https://cran.rstudio.com"))
install.packages("tidyverse")

# Load Tidyverse package
library(tidyverse)

```

I will also need my numerical integration previously coded.


```{r}

# Numerical integration function script
source("N_Integration.R")

```


# 1 ----


Let's test our numerical integration function by estimating the integral of the
function exp(x) from 1 to 5 using the 3 estimation methods with 10 boxes each.


```{r}

## Using the rectangle method, k = 11 for 10 boxes.
integral_estimate(exp, 1, 5, 11, "rectangle")


## Using the trapezoid method, k = 11 for 10 boxes.
integral_estimate(exp, 1, 5, 11, "trapezoid")


## Using Simpson's method, k = 21 for 10 boxes.
integral_estimate(exp, 1, 5, 21, "simpson")

```

# 2 ----


Now we want to estimate the same integral of exp(x) from 1 to 5 using all 3
methods of estimation, but this time we will do it for 5, 10, ..., 50 number
of boxes, and record our results in a data frame.

Let's first create an empty data frame where we will store our results.


```{r}

# Numerical estimation results data frame
estimate_results <- data.frame(
  # Number of boxes
  n_boxes = numeric(),
  # Results from rectangle rule
  Rectangle = numeric(),
  # Results from trapezoid rule
  Trapezoid = numeric(),
  # Results from Simpson's rule
  Simpson = numeric()
)

```


Now let's use a for loop to run our numerical estimation function for all
3 methods and for the number of boxes we want to estimate each time.


```{r}

# Numerical integration of exp(x) function from 1 to 5.
# Will run for all i where i is an integer from 1 to 10
for(i in 1:10){
  # Number of boxes is i times 5
  n_boxes <- i*5
  # Rectangle estimation for k = i*5 + 1 number of cut points
  rectangle_estimate <- integral_estimate(exp, 1, 5, (i*5) + 1, "rectangle")
  # Trapezoid estimation for k = i*5 + 1 number of cut points
  trapezoid_estimate <- integral_estimate(exp, 1, 5, (i*5) + 1, "trapezoid")
  # Rectangle estimation for k = i*10 + 1 number of cut points
  simpson_estimate <- integral_estimate(exp, 1, 5, (i*10) + 1, "simpson")
  # Add results of estimation to data frame
  estimate_results <- rbind(estimate_results, data.frame(
    # Number of boxes
    n_boxes = n_boxes,
    # Results from rectangle rule
    Rectangle = rectangle_estimate,
    # Results from trapezoid rule
    Trapezoid = trapezoid_estimate,
    # Results from Simpson's rule
    Simpson = simpson_estimate
  ))
}

# Data frame result
estimate_results

```


# 3 ----


Now we want to plot our estimations at different number of boxes, and divided
by the method. Since we want to divide them by the method, I will modify our
data frame with the results from all estimations so that there's a column that
specifies the method used, and another column with all results.


```{r}

# New data frame with a column for the method used
estimate_results_method <- estimate_results %>%
  pivot_longer(
    # Apply to all columns except the number of boxes one
    cols = !n_boxes,
    # Create column with the methods used
    names_to = "method",
    # Create column with all values from the estimations
    values_to = "estimate"
  )

# Preview our new data frame
head(estimate_results_method)

```


Now that we have our modified data frame, let's use it to create our plot.


```{r}

# Plot of our data frame
estimate_results_method %>% 
  ggplot(aes(
    # Number of boxes in x-axis
    x = n_boxes, 
    # Estimation value in y-axis
    y = estimate, 
    # Represent method used by color
    col = method
    )
  ) +
  # Line graph with thicker lines
  geom_line(linewidth = 1) +
  # Change theme
  theme_bw() + 
  # Change x label
  xlab("Number of Boxes") + 
  # Change y label
  ylab("Integral Estimation") +
  # Add title
  ggtitle("Numerical Integration of exp(x) from 1 to 5 by Method") +
  # Change legend title
  labs(col = "Method")

```

# 4 ----


Now we want to add a line in the plot that indicates the true value of the 
integration of exp(x) from 1 to 5. Let's first compute this value.


```{r}

# True value of exp(x) from 1 to 5
true_value <- exp(5) - exp(1)

# Show true value
true_value

```


Now let's add a dashed line to our plot that represents this value.


```{r}

# Plot of our data frame
estimate_results_method %>% 
  ggplot(aes(
    # Number of boxes in x-axis
    x = n_boxes, 
    # Estimation value in y-axis
    y = estimate, 
    # Represent method used by color
    col = method
    )
  ) +
  # Line graph with thicker lines
  geom_line(linewidth = 1) +
  # Line with true value of the integral
  geom_hline(
    # Horizontal line at y = true value
    yintercept = c(true_value),
    # Dashed line
    linetype = "dashed"
    ) +
  # Change theme
  theme_bw() + 
  # Change x label
  xlab("Number of Boxes") + 
  # Change y label
  ylab("Integral Estimation") +
  # Add title
  ggtitle("Numerical Integration of exp(x) from 1 to 5 by Method") +
  # Change legend title
  labs(col = "Method")

```

# 5. ----


As we can see, even with a small number of boxes, the Simpson's rule estimates
the value of this integral pretty accurately, so it is not surprising that this
method is the least affected by the increase in the number of boxes. It also 
gets the closest to estimate the true value of the integral, with its estimate
being accurate at least up to 4 decimal points with only 25 boxes.

The trapezoid method overestimates the value of the integral, which is more
pronounced with a smaller number of boxes, but as the boxes increase to 50,
the estimate gets very close to the true value of the integral, but never as 
accurate as the Simpson's method, even comparing the estimate of the trapezoid
method at 50 boxes with the estimate of the Simpson's method at 5 boxes.

The rectangle method on the other hand, underestimates the values of the 
integral, and its estimations are the farthest from the true value of the 
integral at any number of boxes, with its value even at 50 boxes not being a
precise estimation of the value of the integral. 


# 6. ----


Now let's repeat the same process to create a plot of all 3 method of estimation
at 5, 10, ..., 50 number of boxes, but this time we will estimate the integral
of exp(x) from minus infinity to 0.

We will use values that get closer and closer to minus infinity (-100, -10,000, 
and -1,000,000) to see how our results change.

Let's first take a look at an approximation of the true value of our integral
using -1,000,000 as our left endpoint.


```{r}

# Expected true value of our integral of exp(x) from minus infinity to 0.
true_value_neg <- exp(0) - exp(-1000000)

# Look at true value
true_value_neg

```

As expected, this value is simply 1, since exp(0) is one, and as exp(x) 
approaches infinity, its value approaches 0.

Now I'll repeat the same process as parts 2-4 for left endpoints of the integral
being -100, -10,000, and -1,000,000.

Let's start with -100.


```{r}

# Numerical estimation results data frame for -100 left endpoint
estimate_results_100 <- data.frame(
  # Number of boxes
  n_boxes = numeric(),
  # Results from rectangle rule
  Rectangle = numeric(),
  # Results from trapezoid rule
  Trapezoid = numeric(),
  # Results from Simpson's rule
  Simpson = numeric()
)


# Numerical integration of exp(x) function from -100 to 0.
# Will run for all i where i is an integer from 1 to 10
for(i in 1:10){
  # Number of boxes is i times 5
  n_boxes <- i*5
  # Rectangle estimation for k = i*5 + 1 number of cut points
  rectangle_estimate <- integral_estimate(exp, -100, 0, (i*5) + 1, "rectangle")
  # Trapezoid estimation for k = i*5 + 1 number of cut points
  trapezoid_estimate <- integral_estimate(exp, -100, 0, (i*5) + 1, "trapezoid")
  # Rectangle estimation for k = i*10 + 1 number of cut points
  simpson_estimate <- integral_estimate(exp, -100, 0, (i*10) + 1, "simpson")
  # Add results of estimation to data frame
  estimate_results_100 <- rbind(estimate_results_100, data.frame(
    # Number of boxes
    n_boxes = n_boxes,
    # Results from rectangle rule
    Rectangle = rectangle_estimate,
    # Results from trapezoid rule
    Trapezoid = trapezoid_estimate,
    # Results from Simpson's rule
    Simpson = simpson_estimate
  ))
}


# New data frame with a column for the method used
estimate_results_method_100 <- estimate_results_100 %>%
  pivot_longer(
    # Apply to all columns except the number of boxes one
    cols = !n_boxes,
    # Create column with the methods used
    names_to = "method",
    # Create column with all values from the estimations
    values_to = "estimate"
  )


# Plot of our data frame
estimate_results_method_100 %>% 
  ggplot(aes(
    # Number of boxes in x-axis
    x = n_boxes, 
    # Estimation value in y-axis
    y = estimate, 
    # Represent method used by color
    col = method
    )
  ) +
  # Line graph with thicker lines
  geom_line(linewidth = 1) +
  # Line with true value of the integral
  geom_hline(
    # Horizontal line at y = true value
    yintercept = c(true_value_neg),
    # Dashed line
    linetype = "dashed"
    ) +
  # Change theme
  theme_bw() + 
  # Change x label
  xlab("Number of Boxes") + 
  # Change y label
  ylab("Integral Estimation") +
  # Add title
  ggtitle("Numerical Integration of exp(x) from -100 to 0 by Method") +
  # Change legend title
  labs(col = "Method")

```


Let's repeat the same process for -10,000 left endpoint. For this plot, I will
also zoom in to include only value of y = 0 to y = 300 in the plot, otherwise
the plot would be too zoomed out.


```{r}

# Numerical estimation results data frame for -100 left endpoint
estimate_results_10000 <- data.frame(
  # Number of boxes
  n_boxes = numeric(),
  # Results from rectangle rule
  Rectangle = numeric(),
  # Results from trapezoid rule
  Trapezoid = numeric(),
  # Results from Simpson's rule
  Simpson = numeric()
)


# Numerical integration of exp(x) function from -100 to 0.
# Will run for all i where i is an integer from 1 to 10
for(i in 1:10){
  # Number of boxes is i times 5
  n_boxes <- i*5
  # Rectangle estimation for k = i*5 + 1 number of cut points
  rectangle_estimate <- integral_estimate(exp, -10000, 0, (i*5) + 1, "rectangle")
  # Trapezoid estimation for k = i*5 + 1 number of cut points
  trapezoid_estimate <- integral_estimate(exp, -10000, 0, (i*5) + 1, "trapezoid")
  # Rectangle estimation for k = i*10 + 1 number of cut points
  simpson_estimate <- integral_estimate(exp, -10000, 0, (i*10) + 1, "simpson")
  # Add results of estimation to data frame
  estimate_results_10000 <- rbind(estimate_results_10000, data.frame(
    # Number of boxes
    n_boxes = n_boxes,
    # Results from rectangle rule
    Rectangle = rectangle_estimate,
    # Results from trapezoid rule
    Trapezoid = trapezoid_estimate,
    # Results from Simpson's rule
    Simpson = simpson_estimate
  ))
}


# New data frame with a column for the method used
estimate_results_method_10000 <- estimate_results_10000 %>%
  pivot_longer(
    # Apply to all columns except the number of boxes one
    cols = !n_boxes,
    # Create column with the methods used
    names_to = "method",
    # Create column with all values from the estimations
    values_to = "estimate"
  )


# Plot of our data frame
estimate_results_method_10000 %>% 
  ggplot(aes(
    # Number of boxes in x-axis
    x = n_boxes, 
    # Estimation value in y-axis
    y = estimate, 
    # Represent method used by color
    col = method
    )
  ) +
  # Line graph with thicker lines
  geom_line(linewidth = 1) +
  # Line with true value of the integral
  geom_hline(
    # Horizontal line at y = true value
    yintercept = c(true_value_neg),
    # Dashed line
    linetype = "dashed"
    ) +
  # Zoom in on y axis for y = 0 to y = 300
  coord_cartesian(ylim = c(0, 300)) +
  # Change theme
  theme_bw() + 
  # Change x label
  xlab("Number of Boxes") + 
  # Change y label
  ylab("Integral Estimation") +
  # Add title
  ggtitle("Numerical Integration of exp(x) from -10,000 to 0 by Method") +
  # Change legend title
  labs(col = "Method")

```

Finally, let's repeat the same process for -1,000,000 left endpoint. This time I
will zoom in to include only values of y = 0 to y = 30,000 in the plot.


```{r}

# Numerical estimation results data frame for -100 left endpoint
estimate_results_1000000 <- data.frame(
  # Number of boxes
  n_boxes = numeric(),
  # Results from rectangle rule
  Rectangle = numeric(),
  # Results from trapezoid rule
  Trapezoid = numeric(),
  # Results from Simpson's rule
  Simpson = numeric()
)


# Numerical integration of exp(x) function from -100 to 0.
# Will run for all i where i is an integer from 1 to 10
for(i in 1:10){
  # Number of boxes is i times 5
  n_boxes <- i*5
  # Rectangle estimation for k = i*5 + 1 number of cut points
  rectangle_estimate <- integral_estimate(exp, -1000000, 0, (i*5) + 1, "rectangle")
  # Trapezoid estimation for k = i*5 + 1 number of cut points
  trapezoid_estimate <- integral_estimate(exp, -1000000, 0, (i*5) + 1, "trapezoid")
  # Rectangle estimation for k = i*10 + 1 number of cut points
  simpson_estimate <- integral_estimate(exp, -1000000, 0, (i*10) + 1, "simpson")
  # Add results of estimation to data frame
  estimate_results_1000000 <- rbind(estimate_results_1000000, data.frame(
    # Number of boxes
    n_boxes = n_boxes,
    # Results from rectangle rule
    Rectangle = rectangle_estimate,
    # Results from trapezoid rule
    Trapezoid = trapezoid_estimate,
    # Results from Simpson's rule
    Simpson = simpson_estimate
  ))
}


# New data frame with a column for the method used
estimate_results_method_1000000 <- estimate_results_1000000 %>%
  pivot_longer(
    # Apply to all columns except the number of boxes one
    cols = !n_boxes,
    # Create column with the methods used
    names_to = "method",
    # Create column with all values from the estimations
    values_to = "estimate"
  )


# Plot of our data frame
estimate_results_method_1000000 %>% 
  ggplot(aes(
    # Number of boxes in x-axis
    x = n_boxes, 
    # Estimation value in y-axis
    y = estimate, 
    # Represent method used by color
    col = method
    )
  ) +
  # Line graph with thicker lines
  geom_line(linewidth = 1) +
  # Line with true value of the integral
  geom_hline(
    # Horizontal line at y = true value
    yintercept = c(true_value_neg),
    # Dashed line
    linetype = "dashed"
    ) +
  # Zoom in on y axis for y = 0 to y = 30,000
  coord_cartesian(ylim = c(0, 30000)) +
  # Change theme
  theme_bw() + 
  # Change x label
  xlab("Number of Boxes") + 
  # Change y label
  ylab("Integral Estimation") +
  # Add title
  ggtitle("Numerical Integration of exp(x) from -1,000,000 to 0 by Method") +
  # Change legend title
  labs(col = "Method")

```


As we can see, when estimating our integral, the smallest our left endpoint
becomes, meaning the closest our left endpoint gets to minus infinity, the
least accurate our estimations become. This is contrary to the behavior of
limits, where we can more closely see the behavior towards minus infinity
as we get closer to it. Therefore, our numerical methods of estimation may
not be good at estimating values of integrals from minus infinity.

If we look at the shape of the lines in the plots, we can see that they all have
the same shape at any given left endpoint, but the only thing that changes is 
the scale of the y-values, with smaller left endpoints resulting in higher 
y-values of the same proportion (e.g. the y-values of left endpoint -1,000,000 
are 100 bigger than the y-values of left endpoint -10,000).

Both the Trapezoid and Simpson's method overestimate the value of the integral,
while the rectangle method underestimates it. In this case, the rectangle
method actually has the most consistent values as we increase the number of
boxes.

While the Simpson's method was very accurate at estimating the true value
of the integral left end point -100, with the trapezoid being the second most
accurate, and the rectangle being the less accurate, this changes as our
left endpoint becomes smaller.

When our left point is -10,000 and -1,000,000, then the estimate of the 
rectangle method becomes the closest to the true values of the integral, 
which makes sense since it only takes on values from 0 to less than 1 at all 
left end points, so it is more consistent in its estimation as the left endpoint
decreases. On the other hand, the Trapezoid method becomes the least accurate in 
these scenarios.

